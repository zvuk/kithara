[build]
target = "index.html"
dist = "dist"
filehash = false

[serve]
port = 8080
# Required for SharedArrayBuffer (needed by wasm-bindgen-rayon).
headers = { "Cross-Origin-Opener-Policy" = "same-origin", "Cross-Origin-Embedder-Policy" = "require-corp" }

# Fix wasm-bindgen-rayon worker import path.
# workerHelpers.js uses `import('../../..')` which resolves to `/` (HTML),
# not the JS module. Replace with explicit path to kithara-wasm.js.
[[hooks]]
stage = "post_build"
command = "bash"
command_arguments = ["post-build.sh"]
